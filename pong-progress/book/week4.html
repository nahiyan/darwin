<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Week 4 - CSE498R Extended Work</title>
        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="week1.html"><strong aria-hidden="true">1.</strong> Week 1</a></li><li class="chapter-item expanded "><a href="week2.html"><strong aria-hidden="true">2.</strong> Week 2</a></li><li class="chapter-item expanded "><a href="week3.html"><strong aria-hidden="true">3.</strong> Week 3</a></li><li class="chapter-item expanded "><a href="week4.html" class="active"><strong aria-hidden="true">4.</strong> Week 4</a></li><li class="chapter-item expanded "><a href="final-report.html"><strong aria-hidden="true">5.</strong> Final Report</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">CSE498R Extended Work</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="week-4-progress"><a class="header" href="#week-4-progress">Week 4 Progress</a></h1>
<h2 id="goal"><a class="header" href="#goal">Goal</a></h2>
<p>Develop and test a neural network storage format that will involve integration with the persistent models system of Darwin. Eventually, results for the new extension will be generated, outlining its performance. Patterns in the training process will also be observed and noted.</p>
<h2 id="neural-network-storage-format"><a class="header" href="#neural-network-storage-format">Neural Network Storage Format</a></h2>
<p><code>tinyai</code> has its own storage format for the neural networks, which looks something like this:</p>
<pre><code>non-recurrent\n6\n\n1 0\n\n\n1 0\n\n\n1 0\n\n\n2 4\n1 0.0594683 0 -0.462274 4 0.394442 5 0.563337 \n\n0 2\n0 1.06421 1 -0.233392 \n\n0 1\n4 1.07719 \n\n
</code></pre>
<p>The following parameters of the genes are stored:</p>
<ul>
<li>The ANN type (currently only non-recurrent NNs are supported)</li>
<li>Nodes
<ul>
<li>Node type</li>
<li>Number of inward connections</li>
<li>Inward connections
<ul>
<li>Inward connection ID and weight</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>The neural networks are stored instead of genes because of the fact that the eventual goal of the system is to train and produce fit neural networks, which are the end products. Genes are part of the system only for neuroevolution.</p>
</blockquote>
<h2 id="integration-with-the-persistent-models-system"><a class="header" href="#integration-with-the-persistent-models-system">Integration With the Persistent Models System</a></h2>
<p>The persistent models system of Darwin stores the best-fit models (neural networks in this case) in the format generated by <code>tinyai</code>. It's integrated with Pong through a GDNative library, which in turn is used in GDScript to connect with the entirety of the game framework.</p>
<h3 id="functions-of-the-gdnative-library"><a class="header" href="#functions-of-the-gdnative-library">Functions of the GDNative Library</a></h3>
<ul>
<li><code>initiate</code> for loading the models file.</li>
<li><code>model</code> for fetching individual model.</li>
<li><code>count</code> for counting the number of models.</li>
<li><code>stage</code> for staging a specified model.</li>
<li><code>commit</code> for committing a selected number of models.</li>
<li><code>save</code> for writing the changes to the models file.</li>
</ul>
<h3 id="loading-the-models"><a class="header" href="#loading-the-models">Loading the Models</a></h3>
<pre><code class="language-python"># Load models
PersistentModels.initiate(Global.configuration.models_file_path)
</code></pre>
<h3 id="updating-at-the-end-of-every-generation"><a class="header" href="#updating-at-the-end-of-every-generation">Updating at the End of Every Generation</a></h3>
<p>After the end of every generation, the models are staged, committed and saved.</p>
<p>This is how each model is staged:</p>
<pre><code class="language-python">PersistentModels.stage(Neat.model_to_string(model_id), score)
</code></pre>
<p>This is how a commit and save is done:</p>
<pre><code class="language-python">PersistentModels.commit(Global.configuration.saved_models_count)
PersistentModels.save()
</code></pre>
<h3 id="checking-if-there-are-no-saved-models"><a class="header" href="#checking-if-there-are-no-saved-models">Checking if There Are No Saved Models</a></h3>
<p>This is a snippet that checks if no saved model exists in the file.</p>
<pre><code class="language-python">var count = PersistentModels.count()

if count == 0:
    print(&quot;No saved model found.&quot;)
    return
</code></pre>
<h2 id="parallel-evolution"><a class="header" href="#parallel-evolution">Parallel Evolution</a></h2>
<p>Parallel evolution is integrated into the system with each gene representing multiple paddles at the same time. This is dfone to test a gene in various way at the same time in a parallel, rather than sequential, fashion.</p>
<p>In the current version, each gene controls 6 paddles, with each paddle being on each stage. So in total, there are 6 stages, all tested simultaneously. The image below shows all the 6 stages with numerous paddles in each stage.</p>
<p><img src="https://github.com/nahiyan/darwin/raw/gh-pages/pong-progress/book/images/week4/ParallelEvolution.png" alt="" /></p>
<p>As one can observe, the ball are the white and red circles, one in each stage. However, the balls are of two types: </p>
<ul>
<li>Harmful (red)</li>
<li>Harmless (white)</li>
</ul>
<p>Harmful balls will decrease the fitness of a gene if the paddle it controls hits it. Thus, they are supposed to be avoided by the paddles.</p>
<p>On the other side, harmless balls reward a gene if the paddle it's controlling hits it. Thus, they are to be hit for attaining a greater fitness.</p>
<p>After a ball hits a paddle or a bottom boundary, all the paddles in that stage will be rewarded for avoiding or approaching the ball based on its type. Paddles are rewarded for avoiding a harmful ball whereas they are rewarded for approaching a harmless ball. This is done to make fitness calculations continuous and not discrete.</p>
<h1 id="testing"><a class="header" href="#testing">Testing</a></h1>
<p>After a training session, the user has the ability to test a selected subset of the trained models. The models aren't scored here but only simulated in a stage for the human to observe its behavior and performance.</p>
<p><img src="https://github.com/nahiyan/darwin/raw/gh-pages/pong-progress/book/images/week4/Test.png" alt="" /></p>
<h2 id="results"><a class="header" href="#results">Results</a></h2>
<p>The results below are highest fitness vs. generations graphs of 4 training sessions, with each training session being run until it reached a plateau. Population size is varied in each training session.</p>
<p>Parameters shared by all the training sessions:</p>
<table><thead><tr><th>Parameter</th><th>Value</th></tr></thead><tbody>
<tr><td>delta_disjoint</td><td>2.00</td></tr>
<tr><td>delta_weights</td><td>0.40</td></tr>
<tr><td>delta_threshold</td><td>1.30</td></tr>
<tr><td>stale_species</td><td>15</td></tr>
<tr><td>connection_mutate_chance</td><td>0.25</td></tr>
<tr><td>perturb_chance</td><td>0.90</td></tr>
<tr><td>crossover_chance</td><td>0.75</td></tr>
<tr><td>link_mutation_chance</td><td>2.00</td></tr>
<tr><td>node_mutation_chance</td><td>0.50</td></tr>
<tr><td>bias_mutation_chance</td><td>0.40</td></tr>
<tr><td>disable_mutation_chance</td><td>0.40</td></tr>
<tr><td>enable_mutation_chance</td><td>0.20</td></tr>
</tbody></table>
<h3 id="50-genes"><a class="header" href="#50-genes">50 Genes</a></h3>
<p><img src="https://github.com/nahiyan/darwin/raw/gh-pages/pong-progress/book/images/week4/PongResults50.png" alt="" /></p>
<h3 id="100-genes"><a class="header" href="#100-genes">100 Genes</a></h3>
<p><img src="https://github.com/nahiyan/darwin/raw/gh-pages/pong-progress/book/images/week4/PongResults100.png" alt="" /></p>
<h3 id="300-genes"><a class="header" href="#300-genes">300 Genes</a></h3>
<p><img src="https://github.com/nahiyan/darwin/raw/gh-pages/pong-progress/book/images/week4/PongResults300.png" alt="" /></p>
<h3 id="600-genes"><a class="header" href="#600-genes">600 Genes</a></h3>
<p><img src="https://github.com/nahiyan/darwin/raw/gh-pages/pong-progress/book/images/week4/PongResults600.png" alt="" /></p>
<h2 id="observations-and-notes"><a class="header" href="#observations-and-notes">Observations and Notes</a></h2>
<p>In all the training sessions, there are some clear patterns.</p>
<ul>
<li>All of them share similar turning points around when highest fitness is ~5.4.</li>
<li>All of the sessions have ~5.4 fitness highest fitness at the end of the first generation.</li>
<li>The larger the population, the greater the highest fitness at the plateau, which is 8.29, 8.29, 9.31, and 9.34 for 50, 100, 300, and 600 population sizes respectively.</li>
<li>Larger populations usually reach the plateau faster than smaller ones, with the second training session (100 population members) being the exception in this case.</li>
</ul>
<p>Some of the patterns are best explained by probabilities of an individual gene mutating to attain higher fitness. Larger population increases the probability of any gene attaining a greater fitness, increasing the highest fitness of the generations. Moreover, it decreases the chances of reaching a plateau since there are greater number of species, each evolving to developer their own unique characteristics, which in turn decreases the chances of evolution to slow down.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="week3.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="final-report.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="week3.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="final-report.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
